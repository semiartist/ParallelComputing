% test file for MAE 609 Final Project;

clear; close all; clc;

%% STEP 1

n = 100;
Bn = n-1;
sideBn = Bn^2;
sideAn = n+1;
increment = 1/n;

A = zeros(sideAn, sideAn);
h = 0:increment:1;

% initialize A;
A(end, :) = sin(pi*h)*exp(-pi);
A(1,:) = sin(pi*h);

% create a copy of A to store the conjugate result of A;
% conjA = A;

%Create the Bx = b: B matrix;
% B = eye(sideBn)*(4);

for i = 1 : sideBn;
    index = [];
    if (i -1 > 0) && (rem(i-1, Bn)~=0);
        index(end+1) = i-1;
    end
    if (i - Bn > 0);
        index(end+1) = i-Bn;
    end
    if (i + 1 <= (n-1)^2) && (rem(i, Bn) ~= 0);
        index(end + 1) = i+1;
    end
    if i+(Bn) <= (n-1)^2;
        index(end+1) = i+Bn;
    end

    B(i , index) = -1;
    clear index;
end

% b = zeros(sideBn , 1);
% 
% b(1:Bn ,1 ) = A(1,2:(end-1))';
% b( (end - n+2):end , 1) = A(end, 2:(end-1))';

% calculate the conjugate method x;
conjx = zeros((n-1)^2);
% conjx = pcg(B,b, [] , 10000, eye((n-1)^2)*4);
conjx = conjgrad(B, b);

x = zeros(size(b,1),1);


% calcualte the normal method of x;
x = B\b;

% write the x value into A to finish the matrix;
% ptr = 1;
% for i = 2:n
%     A(i, 2:(end-1)) = x(ptr:ptr+(n-2));
%     conjA(i, 2:(end-1)) = conjx(ptr:ptr+(n-2));
%     ptr= ptr + n-1;
% end

realA = zeros(n+1, n+1);

for i = 1:n+1;
    for j = 1:n+1;
        realA(i,j) = sin(pi*increment*(j-1))*exp(-pi* (increment*(i-1)));
    end
end



line1 = [  0.0301307  0.0602323  0.0902756  0.120232  0.150071  0.179766  0.209286  0.238604  0.267692  0.29652  0.325061  0.353288  0.381173  0.40869  0.435811  0.46251  0.488762  0.514541  0.539822  0.564582  0.588794  0.612438  0.635488  0.657925  0.679724  0.700866  0.721329  0.741096  0.760144  0.778459  0.796018  0.81281  0.828813  0.844016  0.858401  0.871957  0.884668  0.896525  0.907512  0.917624  0.926846  0.935173  0.942593  0.949104  0.954694  0.959363  0.963102  0.96591  0.967783  0.968721  0.968721  0.967783  0.96591  0.963102  0.959363  0.954695  0.949104  0.942594  0.935172  0.926846  0.917623  0.907513  0.896524  0.884669  0.871956  0.858402  0.844015  0.828814  0.812809  0.796019  0.778459  0.760144  0.741097  0.721329  0.700867  0.679723  0.657925  0.635489  0.612437  0.588796  0.56458  0.539824  0.514541  0.488762  0.462511  0.435809  0.408692  0.381172  0.35329  0.325061  0.296519  0.267694  0.2386  0.209292  0.179759  0.150079  0.120224  0.0902819  0.0602277  0.0301332 ];
% % line2 = [ 0.00826474  0.0165215  0.0247623  0.0329791  0.041164  0.0493091  0.0574065  0.0654483  0.0734268  0.0813344  0.0891631  0.0969056  0.104555  0.112102  0.119541  0.126865  0.134066  0.141137  0.148071  0.154863  0.161504  0.167989  0.174312  0.180466  0.186446  0.192245  0.197858  0.20328  0.208505  0.213528  0.218345  0.222951  0.22734  0.231511  0.235456  0.239175  0.242662  0.245913  0.248928  0.251701  0.254231  0.256515  0.25855  0.260336  0.261869  0.263149  0.264176  0.264945  0.26546  0.265717  0.265716  0.26546  0.264945  0.264176  0.26315  0.261869  0.260336  0.258549  0.256515  0.254231  0.2517  0.248928  0.245913  0.242662  0.239174  0.235456  0.231511  0.22734  0.222952  0.218344  0.213529  0.208505  0.203279  0.197859  0.192244  0.186447  0.180466  0.174313  0.167989  0.161504  0.154863  0.148071  0.141137  0.134065  0.126865  0.119541  0.112102  0.104554  0.0969058  0.0891632  0.0813342  0.073427  0.0654482  0.0574066  0.049309  0.0411641  0.032979  0.0247623  0.0165215  0.00826476 ];
% line3 = [ 0.00138078  0.00276022  0.00413699  0.00550976  0.0068772  0.00823798  0.0095908  0.0109343  0.0122673  0.0135884  0.0148963  0.0161899  0.0174677  0.0187287  0.0199716  0.0211951  0.0223981  0.0235795  0.024738  0.0258726  0.0269822  0.0280657  0.029122  0.0301502  0.0311492  0.032118  0.0330558  0.0339616  0.0348346  0.0356738  0.0364785  0.037248  0.0379814  0.038678  0.0393373  0.0399585  0.040541  0.0410843  0.0415879  0.0420512  0.0424738  0.0428554  0.0431955  0.0434938  0.0437501  0.043964  0.0441353  0.044264  0.0443499  0.0443928  0.0443928  0.0443498  0.044264  0.0441353  0.0439639  0.0437501  0.0434938  0.0431955  0.0428554  0.0424739  0.0420512  0.0415879  0.0410843  0.040541  0.0399585  0.0393373  0.0386781  0.0379814  0.037248  0.0364785  0.0356738  0.0348345  0.0339616  0.0330558  0.032118  0.0311492  0.0301502  0.029122  0.0280657  0.0269822  0.0258726  0.024738  0.0235795  0.0223981  0.0211951  0.0199716  0.0187287  0.0174677  0.0161899  0.0148963  0.0135884  0.0122673  0.0109343  0.00959085  0.00823797  0.00687714  0.00550988  0.00413683  0.00276037  0.00138068 ];
% 
figure;
h2 = 0:(1/(size(line1,2) + 1)):1;
plot(h(2:end-1) , realA(2,2:end-1), 'r--');
hold on;
plot(h2(2:end-1) , line1, 'b-.' );
% % plot(h , realA(2,:), '--or');
% % plot(h, conjA(2,:), 'b');
% 
% figure;
% plot(h(2:end-1) , conjA(51,2:end-1), 'r--');
% hold on;
% plot(h(2:end-1) , line2, 'b--');
% 
% figure;
% plot(h(2:end-1) , conjA(end-1,2:end-1), 'r--');
% hold on;
% plot(h(2:end-1) , line3, 'b--');


% legend('inv(B)*b', 'calculate method', 'numeric method');

% 
% figure;
% surf(h, h, A);
% 
% figure;
% surf(h, h, realA);
% 
% figure;
% surf(h, h, conjA);
%}